<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Produto Detalhes</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/detalhe.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <!-- Toastr CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" />

</head>
<body>
    
    <!-- Cabeçalho -->
    <header class="header">
        <section class="section-principal">
            <nav class="section-principal-nav">
                <a class="section-principal-nav-logo" href="index.html">
                    <img class="section-principal-nav-logo-img" src="https://http2.mlstatic.com/frontend-assets/ml-web-navigation/ui-navigation/6.6.92/mercadolibre/logo-pt__large_25years@2x.png" alt="Mercado Livre Logo">
                </a>

                <div class="section-principal-nav-search">
                    <input type="text" class="nav-search-input" id="cb1-edit" name="as_word" placeholder="Buscar produtos, marcas e muito mais…" maxlength="120" autocapitalize="off" autocorrect="off" spellcheck="false" autocomplete="off">
                    <button class="section-principal-nav-search-button"><img src="assets/img/search-solid.svg" alt=""></button>
                </div>

                <div class="section-principal-nav-cart">
                    <a href=""><img  class="section-principal-nav-search-img" src="https://http2.mlstatic.com/D_NQ_937445-MLA80710687882_112024-OO.webp" alt=""></a>
                </div>
            </nav>
        </section>
        <section class="section-secundaria">
            <nav class="section-secundaria-nav">
                <button class="section-secundaria-nav-button"> 
                    <img src="" alt="">
                    <p>Informe seu cep</p>
                </button>
                <ol class="section-secundaria-nav-list">
                    <li class="section-secundaria-nav-list-item"><a href="">Categorias</a></li>
                    <li class="section-secundaria-nav-list-item"><a href="">Ofertas</a></li>
                    <li class="section-secundaria-nav-list-item"><a href="">Cupons</a></li>
                    <li class="section-secundaria-nav-list-item"><a href="">Supermercado</a></li>
                    <li class="section-secundaria-nav-list-item"><a href="">Moda</a></li>
                    <li class="section-secundaria-nav-list-item"><a href="">Mercado Play</a></li>
                    <li class="section-secundaria-nav-list-item"><a href="">Vender</a></li>
                    <li class="section-secundaria-nav-list-item"><a href="">Contato</a></li>
                </ol>
            
                <ol>
                    <nav class="section-secundaria-nav-list">
                        <li class="section-secundaria-nav-list-item"><a href="">Crie a sua conta</a></li>
                        <li class="section-secundaria-nav-list-item"><a href="">Entre</a></li>
                        <li class="section-secundaria-nav-list-item"><a href="">Compras</a></li>
                        <li class="section-secundaria-nav-list-item"><a href="carrinho.html"><img src="assets/img/shopping-cart-solid.svg" alt=""></a></li>
                    </nav>
                </ol>
        </section>
    </header>

    <!-- Detalhes do Produto -->
    <main class="produto-detalhes">
        <div class="container mt-5">
            <div class="row">
                <!-- Imagens do Produto -->
                <div class="col-md-6">
                    <div id="imagem-principal">
                        <img src="" alt="Imagem do Produto" class="img-fluid" id="img-principal">
                    </div>
                    <div class="imagens-secundarias mt-3">
                        <div class="row">
                            <div class="col-2">
                                <img src="" alt="Imagem 1" class="img-fluid img-secundaria" data-img="1">
                            </div>
                            <div class="col-2">
                                <img src="" alt="Imagem 2" class="img-fluid img-secundaria" data-img="2">
                            </div>
                            <div class="col-2">
                                <img src="" alt="Imagem 3" class="img-fluid img-secundaria" data-img="3">
                            </div>
                            <div class="col-2">
                                <img src="" alt="Imagem 4" class="img-fluid img-secundaria" data-img="4">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Informações do Produto -->
                <div class="col-md-6">
                    <!-- Código do Produto -->
                    <p><strong>Código:</strong> <span id="codigo-produto"></span></p>

                    <!-- Título -->
                    <h1 id="titulo-produto"></h1>

                    <!-- Descrição -->
                    <p id="descricao-produto"></p>

                    <!-- Preço -->
                    <div class="price-section">
                        <p><strong>Preço:</strong> <span id="preco-produto"></span></p>
                    </div>

                    <!-- Avaliação -->
                    <div class="avaliações">
                        <p><strong>Avaliação:</strong> <span id="avaliacao-produto"></span></p>
                    </div>

                    <!-- Quantidade no Estoque -->
                    <p><strong>Estoque:</strong> <span id="estoque-produto"></span></p>

                    <!-- Botão de Compra -->
                    <div class="add-to-cart">
                        <button class="btn btn-primary" id="adicionar-carrinho">Adicionar ao Carrinho</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container text-center mt-4">
            <p>&copy; 2024 Mercado Livre</p>
        </div>
    </footer>

    <!-- Modal de Login -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="loginModalLabel">Login</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="loginForm">
                        <div class="mb-3">
                            <label for="username" class="form-label">Nome de Usuário</label>
                            <input type="text" class="form-control" id="username" required>
                        </div>
                        <div class="mb-3">
                            <label for="password" class="form-label">Senha</label>
                            <input type="password" class="form-control" id="password" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Login</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        $(document).ready(function() {
    // Pegar o ID do produto na URL
    const urlParams = new URLSearchParams(window.location.search);
    const productId = urlParams.get('id');  // Exemplo: produto.html?id=1

    if (productId) {
        // Carregar os detalhes do produto pela API usando o ID
        $.getJSON(`https://fakestoreapi.com/products/${productId}`, function(product) {
            // Formatar o preço
            const discountPercentage = 14; // Desconto fictício de 14%
            const formattedPrice = (product.price * (1 - discountPercentage / 100)).toFixed(2);

            // Adicionar os detalhes do produto à página
            $('#codigo-produto').text(product.id);  // Código do produto
            $('#titulo-produto').text(product.title);
            $('#descricao-produto').text(product.description);
            $('#preco-produto').text(`R$ ${formattedPrice}`);
            $('#avaliacao-produto').text(`${product.rating.rate} (${product.rating.count} avaliações)`);
            $('#estoque-produto').text(product.stock || 'Indisponível');  // Garantindo que o valor de 'stock' seja exibido corretamente

            // Imagem principal
            $('#img-principal').attr('src', product.image);  

            // Carregar as imagens secundárias
            const secondaryImages = [product.image]; // Se não houver imagens secundárias, usar a principal

            // Caso a API forneça uma lista de imagens adicionais (se disponível)
            if (product.images && Array.isArray(product.images)) {
                secondaryImages.push(...product.images); // Adiciona outras imagens secundárias
            }

            // Preenche as imagens secundárias
            $('.img-secundaria').each(function(index) {
                if (secondaryImages[index]) {
                    $(this).attr('src', secondaryImages[index]);
                } else {
                    $(this).hide(); // Se não houver mais imagens, esconde a imagem
                }
            });

            // Verificar se o usuário está logado antes de adicionar o produto ao carrinho
            $('#adicionar-carrinho').click(function() {
                const user = localStorage.getItem('user');  // Verifica se o usuário está logado

                if (!user) {
                    $('#loginModal').modal('show');  // Exibe o modal de login se não estiver logado
                } else {
                    let cart = JSON.parse(localStorage.getItem('cart')) || []; // Recupera o carrinho existente ou cria um novo
                    cart.push(product.id); // Adiciona o ID do produto ao carrinho
                    localStorage.setItem('cart', JSON.stringify(cart)); // Salva o carrinho atualizado no localStorage

                    // Mostrar a notificação com Toastr
                    toastr.success(`${product.title} foi adicionado ao carrinho!`, 'Produto Adicionado');
                    
                    // Tocar o som de notificação
                    document.getElementById('notificacao-som').play();
                }
            });

            // Login no Modal
            $('#loginForm').submit(function(event) {
                event.preventDefault(); // Impede o envio padrão do formulário
                const username = $('#username').val();
                const password = $('#password').val();

                // Para fins de exemplo, aceitamos qualquer login com qualquer senha
                if (username && password) {
                    localStorage.setItem('user', username);  // Armazena o nome de usuário no localStorage
                    $('#loginModal').modal('hide');  // Fecha o modal após login
                    alert('Login realizado com sucesso!');
                } else {
                    alert('Por favor, preencha os campos de login corretamente.');
                }
            });
        }).fail(function() {
            alert('Produto não encontrado.');
        });
    } else {
        alert('ID do produto não encontrado.');
    }
});


toastr.options = {
    "closeButton": true,
    "debug": false,
    "newestOnTop": true,
    "progressBar": true,
    "positionClass": "toast-top-right",
    "preventDuplicates": true,
    "onclick": null,
    "showDuration": "100",    // 0.3 segundos de animação de entrada
    "hideDuration": "100",   // 1 segundo para desaparecer
    "timeOut": "100",        // 1 segundo de exibição
    "extendedTimeOut": "100"  // 0.5 segundos após o mouse passar sobre a notificação
};


    </script>

    <!-- Toastr JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>

</body>
</html>
